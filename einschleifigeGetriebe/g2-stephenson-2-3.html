<!doctype html>
<html>
<head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Stephenson-2</title>
</head>

<body>
    <h1 style="text-align:center;width:98vw">g2-mechanism image</h1>
    <pre id="out">?</pre>
    <canvas id="c" width="801" height="401" style="border:1px solid black;background-color:#eee;"></canvas><br>
    <span id="out"></span>
<script src="../../g2-ng/g2.js"></script>
<script src="../cstr.js"></script>
<script>
const ctx = document.getElementById('c').getContext('2d');

const A0= {x:0,y:0,base:true,r:6,ls:'navy',lw:2,fs:'snow'};
const B0= {x:200,y:0,base:true,r:6,ls:'navy',lw:2,fs:'snow'};
const A = {x:0,y:100,m:1,r:6,ls:'navy',lw:2,fs:'snow'};
const B = {x:180,y:140,m:1,r:6,ls:'navy',lw:2,fs:'snow'};
const C = {x:60,y:100,m:1,r:6,ls:'navy',lw:2,fs:'snow'};
const D = {x:100,y:240,m:1,r:6,ls:'navy',lw:2,fs:'snow'};
const E = {x:260,y:180,m:1,r:6,ls:'navy',lw:2,fs:'snow'};
const g = g2().view({x:100,y:100,cartesian:true})
              .clr()
              .grid()
              .lin({p1:A0,p2:A,ls:'navy',lw:3})
              .lin({p1:A,p2:C,ls:'navy',lw:3})
              .lin({p1:A,p2:D,ls:'navy',lw:3})
              .lin({p1:C,p2:D,ls:'navy',lw:3})
              .lin({p1:C,p2:B,ls:'navy',lw:3})
              .lin({p1:B0,p2:B,ls:'navy',lw:3})
              .lin({p1:B0,p2:E,ls:'navy',lw:3})
              .lin({p1:B,p2:E,ls:'navy',lw:3})
              .lin({p1:D,p2:E,ls:'navy',lw:3})
              .cir(A0)
              .cir(B0)
              .cir(A)
              .cir(B)
              .cir(C)
              .cir(D)
              .cir(E)

const c = cstr().n2({id:'A0A',n1:A0,n2:A,len:'const',ang:'const'})
                .n2({id:'AC',n1:A,n2:C,len:'const'})
                .n2({id:'AD',n1:A,n2:D,len:'const'})
                .n2({id:'CD',n1:C,n2:D,len:'const'})
//                .n3({id:'ACD',n1:A,n2:C,n3:D,ang:'const'})
                .n2({id:'CB',n1:C,n2:B,len:'const'})
                .n2({id:'DE',n1:D,n2:E,len:'const'})
                .n2({id:'BE',n1:B,n2:E,len:'const'})
//                .n3({id:'B0BE',n1:B0,n2:B,n3:E,ang:'const'})
                .n2({id:'B0B',n1:B0,n2:B,len:'const'})
                .n2({id:'B0E',n1:B0,n2:E,len:'const'})
//const cACD = dualcstr({id:'cACD',c1:cAC,c2:cAD,w:'const'});
//const cACD = tricstr({id:'cACD',n1:A,n2:C,n3:D});
//const cB0B = cstr({id:'cB0B',n1:B0,n2:B,r:'const'});
//const cB0E = cstr({id:'cB0E',n1:B0,n2:E,r:'const'});
//    .n2({id:'cB0BE',n1:B0,n2:B,n3:E})
//const cB0BE = dualcstr({id:'cB0BE',c1:cB0B,c2:cB0E,w:'const'});
//const cBE  = cstr({id:'cBE',n1:B,n2:E,r:'const'});
//const cDE  = cstr({id:'cDE',n1:D,n2:E,r:'const'});

function update() {
    document.getElementById('out').innerHTML = 'itr=' + c.correct();
    g.exe(ctx);
}
/*
function log() {
    for (const b of c.constraints)
        b.a.log();
}
*/
//update();

const crank = c.byId('A0A');
function animate() {
    crank.ang += Math.PI/180;
    update();

    if (crank.ang < 5*Math.PI/2)
        requestAnimationFrame(animate);
}

window.addEventListener('load', animate, false);


</script>
</body>
</html>
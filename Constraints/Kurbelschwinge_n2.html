<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kurbelschwinge n2</title>
</head>


<body>
    <h1 style="text-align:center;width:98vw">Kurbelschwinge n2</h1>
    <pre id="out">?</pre>
    <button onclick="c.correct();g.exe(ctx);c.log()">correct</button><br>
    <canvas id="c" width="601" height="401" style="border:1px solid black;background-color:transparent"></canvas><br>
    <span id="out"></span>
    <script src="./../lib/g2-ng/g2.js"></script>
    <script src="./../lib/cstr2/cstr.js"></script>
    <script>
        //Zugriff auf canvas-Element    
        const ctx = document.getElementById('c').getContext('2d');
        //Interaktionsobjekt erstellen
        const interactor = canvasInteractor.create(ctx, { x: 140, y: 140, cartesian: true });
        // Selektionsobjekt
        const selector = g2.selectorHdl(interactor.evt);


        //Definition der Nodes
        const A0 = { x: 0, y: 0, base: true, label: 'A0' },
            A = { x: 0, y: 50, m: 2, label: 'A' },
            B = { x: 180, y: 110, label: 'B' },
            B0 = { x: 200, y: 10, base: true, label: 'B0' },
            K = { x: 90, y: 120, label: "K" };


        //Definition der Constraints
        const c = cstr().n2({ id: 'A0A', n1: A0, n2: A, len: 'const',ang:'const' })
            .n2({ n1: A, n2: B, len: 'const' })
            .n2({ n1: B0, n2: B, len: 'const' })
            .n2({ n1: A, n2: K, len: 'const' })
            .n2({ n1: B, n2: K, len: 'const' })
           // .n3({ n1: A, n2: B, n3: K, ori: 'const' }) //Alternative funktioniert nicht
        const crank = c.byId('A0A');
        //Zeichnen des Getriebe
        const g = g2().clr()
            .view(interactor.view)
            .lin({ p1: A0, p2: A, lw: 2 }) //Linie
            .lin({ p1: B0, p2: B, lw: 2 })
            .ply({ pts: [A, B, K], lw: 2, closed: true }) //Polygon
            .gnd(A0) //Symbol fÃ¼r gestellfesten Node
            .gnd(B0)
            .hdl(A) //"Handle" - Symbol
            .nod(B)
            .nod(K) //"Node" Symbol            
        g.exe(ctx);

        let itr=0, itrmax=0;
        //Definition der Interaktions- und Animationsmethoden
        interactor
            .on('tick', (e) => {
                crank.ang += Math.PI / 180;                
                const itr = c.correct();
                document.getElementById('out').innerHTML = `itr(max/cur) = ${itrmax = Math.max(itr, itrmax)} / ${itr}`;
                g.exe(ctx);
                if (crank.ang >= 130 * Math.PI / 2)
                    interactor.endTimer();
            })
            .on('pan', (e) => { interactor.view.x += e.dx; interactor.view.y += e.dy; })
           
            .startTimer();
    </script>
</body>

</html>